/* ======================
   DATA LAGU (TIDAK DIUBAH)
====================== */
/* ======================
   DATA LAGU (TIDAK DIUBAH)
====================== */
const songs = {
  0: { audio: "https://raw.githubusercontent.com/NdikzDatabase/Database/main/Database/1762559143736-x3crbj.jpg",
       image: "https://raw.githubusercontent.com/NdikzDatabase/Database/main/Database/1762559143736-x3crbj.jpg", 
       title: "Music not found", 
       artist: "Not artist", 
       views: 0 },
  1: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Bintang%205.mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
       title: "Bintang 5", 
       artist: "Tenxi & Jemsii", 
       views: 21300000 },
  2: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/(Sakit%20Dadaku).mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Sakit%20dadaku.jpg", 
       title: "Garam & Madu (Sakit Dadaku)", 
       artist: "Tenxi",
       views: 250600000},
  3: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/bergema%20sampai%20selamanya.mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/nadhif.jpg", 
       title: "Bergema Sampai Selamanya", 
       artist: "Nadhif Basalamah",
       views: 90100000},
  4: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Surat%20starla.mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Virgoun.png", 
       title: "Surat Cinta Untuk Starla", 
       artist: "Virgoun",
       views: 658900000},
  5: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/SO%20ASU.mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/SO%20ASU.png", 
       title: "SO ASU", 
       artist: "Naykilla",
       views: 5820000},
  6: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/mejikuhibiniu.mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/mejikuhibiniu.jpg", 
       title: "Mejikuhibiniu", 
       artist: "Tenxi, Suisei & Jemsii",
       views: 68400000},
  7: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/penjaga%20hati.mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/penjaga%20hti.jpg", 
       title: "Penjaga Hati", 
       artist: "Nadhif Basalamah",
       views: 286500000},
  8: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Aku%20Dah%20Lupa.mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Aku%20Dah%20Lupa.jpg", 
       title: "Aku Dah Lupa", 
       artist: "MikkyZia",
       views: 90300000},
  9: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Mangu.mp3", 
       image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/mangu.jpg", 
       title: "Mangu", 
       artist: "Fourtwnty",
       views: 305700000},
  10: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Kasih%20Aba%20Aba.mp3",     image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/kasih%20aba%20aba.jpg", 
        title: "Kasih Aba Aba", 
        artist: "Naykilla, Tenxi & Jemsii",
        views: 77200000},
  11: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Berubah.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Berubah.jpg", 
        title: "Berubah", 
        artist: "Tenxi & Jemsii",
        views: 10600000},
  12: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Oh%20no,%20I%20like%20you.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Oh%20no%2CI%20like%20you.jpg", 
        title: "Oh no, I like you", 
        artist: "Auric Veil",
        views: 6440000
  },
  13: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/die%20with%20a%20smile.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/die%20with%20a%20smile.jpg", 
        title: "Die With A Smile", 
        artist: "Lady Gaga",
        views: 2800000000},
  14: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Kangen.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Kangen.jpg", 
        title: "Kangen", 
        artist: "DEWA 19",
        views: 211600000},
  15: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/That%20Smile%20is%20a%20Trap.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/That%20smile%20is%20a%20trap.jpg", 
        title: "That Smile Is A Trap", 
        artist: "Auric Veil",
        views: 1800000},
  16: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Bintang%20di%20Surga.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/NoahBintangdiSurga.jpg", 
        title: "Bintang Di Surga", 
        artist: "NOAH",
        views: 143700000},
  17: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Anugerah%20Terindah.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Anigrah%20Terindah.jpg", 
        title: "Anugrah Terindah", 
        artist: "Andmesh",
        views: 257800000},
  18: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Aku%20Milikmu.mp3",     
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/IMG_0730.jpeg", 
        title: "Aku Milikmu", 
        artist: "DEWA 19",
        views: 11410000},
  19: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Pupus.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/IMG_0731.jpeg", 
        title: "Pupus", 
        artist: "DEWA 19",
        views: 181600000},
  20: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Separuh%20Nafas.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/IMG_0732.jpeg", 
        title: "Separuh Nafasku", 
        artist: "DEWA 19",
        views: 70600000},
  21: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Somewhere%20Only%20We%20Know.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/somewhere1.jpg", 
        title: "Somewhere Only We Know", 
        artist: "Gustixa",
        views: 106700000},
   22: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/hoRRReg.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
        title: "hoRRReg", 
        artist: "Tenxi, Naufal Syachreza & Jemsii",
        views: 10400000},
   23: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/SENCY.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/IMG_0733.webp", 
        title: "SENCY", 
        artist: "dia & Tenxi",
        views: 226000},
   24: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Puting%20Beliung.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
        title: "Puting Beliung (feat. dia)", 
        artist: "Tenxi, Josua Natanael & Jemsii",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views:1900000},
   25: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/1%2010.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/IMG_0734.jpeg", 
        title: "1/10 (feat. RYO)", 
        artist: "Tenxi & RYO"
        ,
        views: 1400000
   },
   26: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/attached.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/IMG_0735.jpeg", 
        title: "attached", 
        artist: "Tenxi, Anangga & Suisei",
        views: 1630000
   },
  27: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Paling%20Sabi.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
        title: "Paling sabi", 
        artist: "Tenxi, RYO, dia & Jemsii",
        views: 989300
  },
  28: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Coba%20Lagi.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/ubah%20lagi.jpg", 
        title: "Coba Lagi", 
        artist: "Tenxi & Jemsii",
        views: 3560000
  },
  29: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Yodah%20ku%20Selingkuh.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
        title: "Yodah ku Selingkuh", 
        artist: "Tenxi, Lucidrari & Jemsii",
        views: 720000
  },
  30: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Bayangno%20Awakmu.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
        title: "Bayangno Awakmu", 
        artist: "Tenxi & Jemsii",
        views: 739700},
  31: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Apa%20Lagi.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
        title: "Apa Lagi", 
        artist: "Tenxi, Anangga & Jemsii",
        views: 458500},
  32: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Dikasih%20Akses.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
        title: "Dikasih Akses", 
        artist: "Tenxi & Jemsii",
        views: 255100},
  33: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Buku%20Baru%20(Interlude).mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Bintang5.jpg", 
        title: "Buku Baru (Interlude)", 
        artist: "Tenxi & Jemsii",
        views: 220500},
  34: { audio: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/%E5%85%AB%E6%96%B9%E4%BE%86%E8%B2%A1%20(Stacks%20from%20All%20Sides).mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/%E5%85%AB%E6%96%B9%E4%BE%86%E8%B2%A1(Stacks%20from%20All%20Sides).jpg", 
        title: "å…«æ–¹ä¾†è²¡(Stacks from All Sides)", 
        artist: "æ”¬ä½¬SKAI ISYOURGOD",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 136500000},
   35: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Somewhere%20Only%20We%20Know%20(1).mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/somewhere2.jpg", 
        title: "Somewhere Only We Know", 
        artist: "Keane",
        views: 1600000000},
  36: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Tor%20Monitor%20Ketua.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/artworks-tY0vRpEXFSNj-0-t500x500.png", 
        title: "Tor Monitor Ketua", 
        artist: "DJ SIBUK",
        views: 712000
  },
  37: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/MALA.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Mala%20(6ix9ine).jpg", 
        title: "MALA (feat. Anuel Aa)", 
        artist: "6ix9ine",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 393400000},
  38: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Amin%20Paling%20Serius.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/amin%20paling%20serius.jpg", 
        title: "Amin Paling Serius", 
        artist: "Sal Priadi & Nadin Amizah",
        views: 58500000},
  39: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Starboy.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/starboy.jpg", 
        title: "Starboy (feat, Duft Punk)", 
        artist: "The Weeknd",
        views: 3800000000},
  40: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/One%20Of%20The%20Girls.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/One%20Of%20The%20Girls.jpg", 
        title: "One Of The Girls", 
        artist: "The Weeknd, JENNIE & Lily Rose Depp",
        views: 1200000000},
  41: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Timeless.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Timeless.jpg", 
        title: "Timeless",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        artist: "The Weeknd & Playboi Carti",
        views: 414500000},
  42: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Blinding%20Lights.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/The_Weeknd_-_Blinding_Lights.png", 
        title: "Blinding Light", 
        artist: "The Weeknd",
        views: 3400000000},
  43: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Save%20Your%20Tears.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Save%20your%20Tears.jpg", 
        title: "Save Your Tears", 
        artist: "The Weeknd",
        views: 3000000000},
  44: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Die%20For%20You%20(Remix).mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/die%20for%20you.jpg", 
        title: "Die For You (Remix)", 
        artist: "The Weeknd & Ariana Grande",
        views: 777300000},
  45: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Girl%20You%20Loud.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Girl%20you%20Loud.jpg", 
        title: "Girl You Loud", 
        artist: "Chris Brown & Tyga",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 35200000},
  46: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/%D0%AF%D0%B4.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/erika%20lundmoen.jpg", 
        title: "Ð¯Ð´", 
        artist: "Erika Lundmoen",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 170600000},
  47: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Swimming%20Pools%20(Drank).mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/SwimmingPools.jpg", 
        title: "Swimming Pools (Drank)", 
        artist: "Kendrick Lamar",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 714700000},
  48: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/HUMBLE..mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/HUMBLE.jpg", 
        title: "HUMBLE", 
        artist: "Kendrick Lamar",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 1500000000},
  49: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/FE!N.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Fein.jpg", 
        title: "FE!N (feat, Playboi Carti)", 
        artist: "Travis Scott",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 602800000},
  50: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Love%20Me.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Lil%20Wayne.jpg", 
        title: "Love Me (feat, Drake Future)", 
        artist: "Lil Wayne",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 1000000000},
   51: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/PELIGROSA.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/peligrosa.jpg", 
        title: "PELIGROSA", 
        artist: "FloyyMenor",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 311400000},
  52: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Old%20Town%20Road%20(Remix).mp3",
        audio_320: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Old%20Town%20Road.mp3",
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/old%20town%20roand.jpg",
        title: "Old Town Road (Remix) - (feat, Billy Ray Cyrus)", 
        artist: "Lil Nas X",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 3850000000},
  53: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Gata%20Only.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Gata%20Only.jpg", 
        title: "Gata Only", 
        artist: "FloyyMenor & Cris Mj",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 1400000000},
  54: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/BAND4BAND.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/BAND4BAND.jpg", 
        title: "BAND4BAND", 
        artist: "Central Lee & Lil Baby",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 384700000},
  55: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/redrum.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/redrum.jpg", 
        title: "redrum", 
        artist: "21 Savage",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 336200000},
  56: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Popular%20(From%20The%20Idol%20Vol.%201%20(Music%20from%20the%20HBO%20Original%20Series)).mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/popular.jpg", 
        title: "Popular (From The Idol Vol. 1 (Music from the HBO Original Series)) (feat, Playboi Carti)", 
        artist: "The Weeknd",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 384300000},
  57: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Mask%20Off.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/mask%20off.jpg", 
        title: "Mask Off", 
        artist: "Future",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 1400000000},
  58: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Dangerous%20Woman.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/women.png", 
        title: "Dangerous Woman", 
        artist: "Ariana Grande",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 1200000000},
  59: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Hotel%20Room.mp3", 
        image: "https://raw.githubusercontent.com/pretyfx69/music-files/refs/heads/main/hotel%20room.jpg", 
        title: "Hotel Room", 
        artist: "FLVCKKA, Sleezy O & Maury",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 427800000},
  60: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/NOW%20OR%20NEVER.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/NOW%20OR%20NEVER.jpg", 
        title: "NOW OR NEVER", 
        artist: "TKandz & CXSPER",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 11500000},
  61: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/No%20Pole.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/no%20pole.jpg", 
        title: "No Pole", 
        artist: "Don Toliver",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 142500000},
  62: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Again.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/again.jpg", 
        title: "Again (feat, XXXTENTACION)", 
        artist: "Noah Cyrus & XXXTENTACION",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 306200000},
  63: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Gata%20Only%20(Remix).mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/gata%20only%20remix.jpg", 
        title: "Gata Only (Remix)", 
        artist: "FloyyMenor, Ozuna & Anitta",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 87100000},
  64: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/You%20Don't%20Own%20Me.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/you%20dont.jpg", 
        title: "You Don't Own Me", 
        artist: "SAYGRACE & G-Eazy",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 717600000},
  65: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Mind%20Games.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/mind%20games.jpg", 
        title: "Mind Games", 
        artist: "Sickick",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 249200000},
  66: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Renegade.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/renearge.jpg", 
        title: "Renegade", 
        artist: "Aaryan Shah",
        tags: ["ðŸ˜ðŸ¤™ðŸ»",],
        views: 111300000},
  67: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Low%20Life.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/low%20life.jpg", 
        title: "Low Life (feat, The Weeknd)", 
        artist: "Future & The Weeknd",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 1200000000},
  68: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Embrace%20It.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/embrace%20it.jpg", 
        title: "Embrace It", 
        artist: "Ndotz",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 95100000},
  69: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Descer.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/descer.jpg", 
        title: "Descer", 
        artist: "Kew & Dj LK da EsÄ‡oria",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 61800000},
  70: { audio: "https://github.com/PretyFX69/music-files/raw/refs/heads/main/Havana.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/havana.jpg", 
        title: "Havana (feat, Young Thug)", 
        artist: "Camila Cabello & Young Thug",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 4000000000},
  71: { audio: "https://github.com/PretyFX69/music-files/refs/heads/main/Dat%20tick.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/dat%20stick.jpg", 
        title: "Dat $tick", 
        artist: "Rich Brian",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 249200000},
  72: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/Still%20With%20You.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/still%20witth%20you.jpg", 
        title: "Still With You", 
        artist: "Jung Kook",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 144800000},
  73: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/nuts.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/nuts.png", 
        title: "nuts", 
        artist: "Lil Peep & rainy bear",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 108300000},
  74: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/Swim.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/swim.jpg", 
        title: "Swim", 
        artist: "Chase Atlantic",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 540700000},
  75: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/Reminder.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/reminder.png", 
        title: "Reminder", 
        artist: "The Weeknd",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 907900000},
  76: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/Rock%20That%20Body.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/rock%20that.jpg", 
        title: "Rock That Body", 
        artist: "Black Eyed Peas",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 424600000},
  77: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/Too%20Many%20Nights.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/too%20many.png", 
        title: "Too Many Nights (feat, Don Toliver & With Future)", 
        artist: "Metro Boomin, Future & Don Toliver",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 400600000},
  78: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/S%C3%A3o%20Paulo.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files/refs/heads/main/Timeless.jpg", 
        title: "SÃ£o Paulo (feat, Anitta)", 
        artist: "The Weeknd & Anitta",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 181900000},
  79: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/She%20Will.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/she%20will.jpg", 
        title: "She Will", 
        artist: "Lil Wayne & Drake",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 189600000},
  80: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/Call%20Out%20My%20Name.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/call%20out.png", 
        title: "Call Out My Name", 
        artist: "The Weeknd",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 1600000000},
  81: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/The%20Hills.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/the%20hills.jpg", 
        title: "The Hills", 
        artist: "The Weeknd",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 2700000000},
  82: { audio: "https://github.com/PretyFX69/music-files2/raw/refs/heads/main/Around%20Me.mp3", 
        image: "https://raw.githubusercontent.com/PretyFX69/music-files2/refs/heads/main/too%20many.png", 
        title: "Around Me (feat, Don Toliver)", 
        artist: "Metro Boomin & Don Toliver",
        tags: ["ðŸ˜ðŸ¤™ðŸ»"],
        views: 76900000},
}; 

/* ======================
   VARIABEL GLOBAL (DIPERBAIKI)
   - currentRealIndex: index asli pada playlist[]
   - currentFilteredIndex: posisi dalam filteredList (jika filteredMode)
   - filteredMode: boolean
====================== */
const playlist = Object.keys(songs).map(k => ({ id: k, ...songs[k] }));

let currentRealIndex = 0;        // index pada playlist[]
let currentFilteredIndex = -1;   // posisi dalam filteredList (0..n-1), -1 saat tidak filtered
let isPlaying = false;
let isLoop = false;
let filteredMode = false;
let filteredList = [];

/* ----------------------
   ELEMENT DOM
---------------------- */
const audio = document.getElementById('audioPlayer');
const cd = document.getElementById('cd');
const playBtn = document.getElementById('playBtn');
const nextBtn = document.getElementById('nextBtn');
const prevBtn = document.getElementById('prevBtn');
const progressEl = document.getElementById('progress');
const seekBar = document.getElementById('seekBar');
const currText = document.getElementById('current');
const durText = document.getElementById('duration');
const nowTitle = document.getElementById('nowTitle');
const nowArtist = document.getElementById('nowArtist');
const playlistBox = document.getElementById('playlistBox');
//const songSelect = document.getElementById('songSelect');
const searchSong = document.getElementById('searchSong');
const toggleLoopBtn = document.getElementById('toggleLoop');
const visualBars = document.querySelectorAll('.bar');

const menuBtn = document.getElementById("menuBtn");
const menuPanel = document.getElementById("menuPanel");
const qualityMenuBtn = document.getElementById("qualityMenuBtn");
const qualitySub = document.getElementById("qualitySubmenu");
const sleepBtn = document.getElementById("sleepTimeBtn");
const sleepSub = document.getElementById("sleepSubmenu");
const equalizerBtn = document.getElementById("equalizerBtn");
const equalizerSubmenu = document.getElementById("equalizerSubmenu");
const reportBtn = document.getElementById("reportBtn");

/* ======================
   UTILITY FUNCTIONS
====================== */
document.getElementById("openWebsite").addEventListener("click", () => {
    window.open("https://pretyfx69.github.io/Music-CyberZain2/", "_blank"); 
});
function formatViews(v) {
  if (!v) return "0 pemutaran";
  if (v >= 1000000000) return (v / 1000000000).toFixed(1) + " M pemutaran";
  if (v >= 1000000) return (v / 1000000).toFixed(1) + " jt pemutaran";
  if (v >= 1000) return (v / 1000).toFixed(0) + " rb pemutaran";
  return v + "x diputar";
}

function formatTime(s) {
    if (!s || isNaN(s)) return "0:00";
    const m = Math.floor(s / 60);
    const sec = Math.floor(s % 60);
    return `${m}:${sec < 10 ? '0'+sec : sec}`;
}

/* ======================
   SCROLLING TITLE FIX
====================== */
function updateScrollingTitle() {
    const title = document.getElementById("nowTitle");
    const wrap  = document.querySelector(".title-wrap");
    title.classList.remove("scrolling");
    if (title.scrollWidth <= wrap.clientWidth) return;
    // restart animation
    void title.offsetWidth;
    title.classList.add("scrolling");
}

/* ======================
   LOAD & PLAY LAGU (CORE)
   - loadSongByIndex(i) expects i = index in playlist[]
====================== */
function loadSongByIndex(i) {
  // SAFEGUARD
  if (typeof i !== 'number' || i < 0 || i >= playlist.length) return;

  currentRealIndex = i;
  // When not filtered, reset filteredIndex; but do not disable filteredMode automatically
  // (we keep filteredMode until user clears search)
  const s = playlist[currentRealIndex];

  // set audio
  audio.src = s.audio;
  audio.load();

  // ui
  cd.style.backgroundImage = `url('${s.image}')`;
  nowTitle.textContent = s.title;
  nowArtist.textContent = s.artist;

  // small delay to update scrolling title after DOM text change
  setTimeout(updateScrollingTitle, 120);

  // highlight correct item in rendered list
  highlightPlaying();
}

/* ======================
   RENDER PLAYLIST (FULL OR FILTERED)
   - If list is full playlist, items' data-index = playlist index
   - If list is filteredList, items' data-index = filtered position (pos)
====================== */
function renderPlaylist(list, isFiltered = false) {
  playlistBox.innerHTML = "";
  // songSelect.innerHTML = '<option value="">â€” Music Yang Tersedia â€”</option>';  â† HAPUS

  list.forEach((s, idx) => {
    const div = document.createElement('div');
    div.className = 'song-item';

    if (isFiltered) {
      div.dataset.index = idx;
    } else {
      const playlistIndex = playlist.findIndex(p => String(p.id) === String(s.id));
      div.dataset.index = playlistIndex >= 0 ? playlistIndex : idx;
    }

    div.innerHTML = `
      <div class="song-meta">
        <div class="song-title">${s.title}</div>
        <div class="song-artist">${s.artist}</div>
      </div>
      <div class="song-views" style="font-size:12px; opacity:0.6; white-space:nowrap;">
        ${formatViews(s.views || 0)}
      </div>
    `;

    div.addEventListener('click', () => {
      if (isFiltered) {
        filteredMode = true;
        currentFilteredIndex = idx;
        const realIndex = list[idx].index;
        loadSongByIndex(realIndex);
        playAudio();
      } else {
        filteredMode = false;
        currentFilteredIndex = -1;
        const realIndex = Number(div.dataset.index);
        loadSongByIndex(realIndex);
        playAudio();
      }
    });

    playlistBox.appendChild(div);

    // âŒ Bagian pembuatan option SongSelect â€” DIHAPUS
    // const opt = document.createElement('option');
    // opt.value = optId;
    // opt.textContent = `${optTitle} - ${optArtist}`;
    // songSelect.appendChild(opt);
  });

  highlightPlaying();
}

/* ======================
   HIGHLIGHT currently playing item
   - Works for both filteredMode & full playlist render
====================== */
function highlightPlaying() {
    const items = playlistBox.querySelectorAll('.song-item');
    items.forEach(it => it.style.outline = "");

    if (filteredMode && filteredList.length) {
        // We rendered filteredList -> currentFilteredIndex is position in filteredList
        const item = playlistBox.querySelector(`.song-item[data-index="${currentFilteredIndex}"]`);
        if (item) {
            item.style.outline = "2px solid rgba(255,255,255,0.1)";
            item.scrollIntoView({ behavior: "smooth", block: "center" });
            return;
        }
    }
    // Otherwise try to highlight by playlist index (data-index = playlist index)
    const itemByReal = playlistBox.querySelector(`.song-item[data-index="${currentRealIndex}"]`);
    if (itemByReal) {
        itemByReal.style.outline = "2px solid rgba(255,255,255,0.1)";
        itemByReal.scrollIntoView({ behavior: "smooth", block: "center" });
    }
}

/* ======================
   AUDIO CONTEXT + EQUALIZER
====================== */
let audioCtx, track;
let bassEQ, midEQ, trebleEQ;

function initAudio() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        track = audioCtx.createMediaElementSource(audio);

        bassEQ = audioCtx.createBiquadFilter();
        bassEQ.type = 'lowshelf';
        bassEQ.frequency.value = 250;
        bassEQ.gain.value = 0;

        midEQ = audioCtx.createBiquadFilter();
        midEQ.type = 'peaking';
        midEQ.frequency.value = 1000;
        midEQ.Q.value = 1;
        midEQ.gain.value = 0;

        trebleEQ = audioCtx.createBiquadFilter();
        trebleEQ.type = 'highshelf';
        trebleEQ.frequency.value = 4000;
        trebleEQ.gain.value = 0;

        track.connect(bassEQ);
        bassEQ.connect(midEQ);
        midEQ.connect(trebleEQ);
        trebleEQ.connect(audioCtx.destination);
    }
}

function resumeAudioCtx() {
    if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
}

function setEqualizer(mode) {
    if (!bassEQ) return;
    switch(mode) {
        case 'bass':
            bassEQ.gain.value = 15;
            midEQ.gain.value = 0;
            trebleEQ.gain.value = 0;
            break;
        case 'treble':
            bassEQ.gain.value = 0;
            midEQ.gain.value = 0;
            trebleEQ.gain.value = 15;
            break;
        case 'flat':
            bassEQ.gain.value = 0;
            midEQ.gain.value = 0;
            trebleEQ.gain.value = 0;
            break;
    }
}

document.querySelectorAll('#equalizerSubmenu .submenu-item').forEach(item => {
    item.addEventListener('click', () => {
        initAudio();
        resumeAudioCtx();
        const eq = item.dataset.eq;
        setEqualizer(eq);
        equalizerSubmenu.style.display = "none";
    });
});

/* ======================
   DOWNLOAD & QUALITY
====================== */
document.getElementById("downloadMusic").addEventListener("click", () => {
    let currentSong;

    if (filteredMode && filteredList.length > 0 && currentFilteredIndex >= 0) {
        currentSong = filteredList[currentFilteredIndex];
    } else {
        currentSong = playlist[currentRealIndex];
    }

    if (!currentSong || !currentSong.audio) {
        alert("Tidak ada lagu untuk di-download!");
        return;
    }

    const a = document.createElement("a");
    a.href = currentSong.audio;
    a.download = (currentSong.title || "track") + ".mp3";
    document.body.appendChild(a);
    a.click();
    a.remove();

    alert(`Download: ${currentSong.title} - ${currentSong.artist}`);
});

qualitySub.querySelectorAll(".submenu-item").forEach(item => {
    item.addEventListener("click", () => {
        const q = item.dataset.quality; // "96", "128", "192", "320"
        const s = (filteredMode && filteredList.length && currentFilteredIndex >= 0)
                    ? filteredList[currentFilteredIndex]
                    : playlist[currentRealIndex];

        const file = (s && (s[`audio_${q}`] || s.audio)) || "";

        if (!file) {
            alert("File audio untuk kualitas " + q + " kbps tidak tersedia untuk lagu ini.");
            qualitySub.style.display = "none";
            return;
        }

        audio.src = file;
        audio.load();
        audio.play().catch(err => console.log("Play error after switching quality:", err));

        alert("Kualitas audio diatur ke: " + q + " kbps");
        qualitySub.style.display = "none";
    });
});

/* ===== KECEPATAN MUSIC ===== */
document.getElementById("speedControl").addEventListener("click", () => {
    const speed = prompt("Masukkan kecepatan music", audio.playbackRate);
    if (speed) {
        audio.playbackRate = parseFloat(speed);
    }
});

/* ======================
   PLAY / PAUSE
====================== */
function playAudio() {
    initAudio();
    if (!audio.src) loadSongByIndex(0);
    resumeAudioCtx();
    audio.play().then(() => {
        isPlaying = true;
        playBtn.textContent = "ð—œð—œ";
        cd.classList.add('playing');
    }).catch(err => console.log("Audio play error:", err));
}

function playAudio() {
  if (!audio.src) loadSongByIndex(0);

  audio.play().then(() => {
    isPlaying = true;
    playBtn.textContent = "ð—œð—œ";
    cd.classList.add('playing');
  });
}

function pauseAudio() {
  audio.pause();
  isPlaying = false;
  playBtn.textContent = "â–¶";
  cd.classList.remove('playing');
}

playBtn.addEventListener('click', () => {
  isPlaying ? pauseAudio() : playAudio();
});

/* ======================
   NEXT / PREV (FINAL, FIXED)
====================== */
nextBtn.addEventListener('click', () => {
  if (filteredMode && filteredList.length && currentFilteredIndex >= 0) {
    if (currentFilteredIndex + 1 < filteredList.length) {
      currentFilteredIndex++;
      const realIndex = filteredList[currentFilteredIndex].index;
      loadSongByIndex(realIndex);
      playAudio();
    }
  } else {
    // normal playlist
    const nextReal = (currentRealIndex + 1) % playlist.length;
    loadSongByIndex(nextReal);
    playAudio();
  }
});

prevBtn.addEventListener('click', () => {
  if (filteredMode && filteredList.length && currentFilteredIndex >= 0) {
    if (currentFilteredIndex - 1 >= 0) {
      currentFilteredIndex--;
      const realIndex = filteredList[currentFilteredIndex].index;
      loadSongByIndex(realIndex);
      playAudio();
    }
  } else {
    const prevReal = (currentRealIndex - 1 + playlist.length) % playlist.length;
    loadSongByIndex(prevReal);
    playAudio();
  }
});

/* ------ LOOP TOGGLE ------ */
toggleLoopBtn.addEventListener('click', () => {
  isLoop = !isLoop;
  audio.loop = isLoop;
  toggleLoopBtn.textContent = `Mode: ${isLoop ? 'Music Akan Diulang Otomatis' : 'Mengganti Music Selanjutnya'}`;
});

/* ======================
   PROGRESS BAR
====================== */
audio.addEventListener('timeupdate', () => {
  if (audio.duration) {
    const w = (audio.currentTime / audio.duration) * 100;
    progressEl.style.width = w + "%";
    currText.textContent = formatTime(audio.currentTime);
    durText.textContent = formatTime(audio.duration);
  }
});

seekBar.addEventListener('click', (e) => {
    if (!audio.duration) return;
    const r = seekBar.getBoundingClientRect();
    audio.currentTime = ((e.clientX - r.left) / r.width) * audio.duration;
});

/* ======================
   AUDIO ENDED (FINAL FIX)
====================== */
audio.addEventListener("ended", () => {
  cd.classList.remove('playing');
  isPlaying = false;
  playBtn.textContent = "â–¶";

  if (audio.loop) return;

  if (filteredMode && filteredList.length && currentFilteredIndex >= 0) {
    if (currentFilteredIndex + 1 < filteredList.length) {
      currentFilteredIndex++;
      const realIndex = filteredList[currentFilteredIndex].index;
      loadSongByIndex(realIndex);
      playAudio();
    } else {
      // end of filtered list: stop (or optionally wrap)
      // we choose to stop and keep filteredMode active
      // If you want wrap within filtered list, uncomment below:
      // currentFilteredIndex = 0; loadSongByIndex(filteredList[0].index); playAudio();
    }
  } else {
    // normal playlist continue
    const nextReal = (currentRealIndex + 1) % playlist.length;
    loadSongByIndex(nextReal);
    playAudio();
  }
});

/* ======================
   SEARCH / FILTER (SUPER AKURAT)
   - search by title / artist / tags / id
====================== */
function filterSongs() {
  const q = (searchSong.value || "").trim().toLowerCase();

  if (q === "") {
    // show full playlist
    filteredMode = false;
    filteredList = [];
    currentFilteredIndex = -1;
    renderPlaylist(playlist, false);
    highlightPlaying();
    return;
  }

  // build filteredList with original playlist indices
  filteredList = playlist
    .map((s, i) => ({ ...s, index: i }))
    .filter(s => {
      const text = (s.title + " " + s.artist + " " + (s.tags || []).join(" ")).toLowerCase();
      // more advanced: allow partial tokens and multi-word
      const tokens = q.split(/\s+/).filter(Boolean);
      // every token must match somewhere (AND search) â€” like YT/Spotify feel
      return tokens.every(tok => text.includes(tok));
    });

  // reset filtered pointer to first match
  filteredMode = true;
  currentFilteredIndex = filteredList.length ? 0 : -1;

  // show filtered render (we render filteredList but keep playlist indices inside objects)
  renderPlaylist(filteredList, true);

  // if there's at least 1 result, auto-select first result (but do not autoplay unless user clicks)
  if (filteredList.length) {
    // highlight first filtered result
    highlightPlaying();
  }
}

/* Support pressing Enter on search to auto-play first match */
searchSong.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    filterSongs();
    if (filteredList.length) {
      currentFilteredIndex = 0;
      loadSongByIndex(filteredList[0].index);
      playAudio();
    }
  } else {
    // on other keys, filter live
    setTimeout(filterSongs, 0);
  }
});

/* ======================
   CATEGORY SELECT (BARU)
   - Menambahkan select kategori yang mengambil lagu berdasarkan tags:
     ["Playlist Anda", "Lagu Terbaru", "Sedang Trend"]
   - Jika elemen <select id="categorySelect"> tidak ada di HTML, kita buat otomatis
====================== */
let categorySelect = document.getElementById("categorySelect");
if (!categorySelect) {
  // try to create and insert it just above songSelect to avoid modifying other layout files
  categorySelect = document.createElement("select");
  categorySelect.id = "categorySelect";
  categorySelect.innerHTML = `
    <option value="">â€” Pilih Kategori â€”</option>
    <option value="Playlist Anda">Playlist Anda</option>
    <option value="Lagu Terbaru">Lagu Terbaru</option>
    <option value="Sedang Trend">Sedang Trend</option>
  `;
  // insert before songSelect if possible, otherwise append to body
  if (songSelect && songSelect.parentNode) {
    songSelect.parentNode.insertBefore(categorySelect, songSelect);
  } else {
    document.body.insertBefore(categorySelect, document.body.firstChild);
  }
}

function filterByCategory(tag) {
  if (!tag) {
    // Reset ke full playlist
    filteredMode = false;
    filteredList = [];
    currentFilteredIndex = -1;
    renderPlaylist(playlist, false);
    return;
  }

  // build filteredList from playlist (keep original indices)
  filteredList = playlist
    .map((s, i) => ({ ...s, index: i }))
    .filter(s => (s.tags || []).includes(tag));

  filteredMode = true;
  currentFilteredIndex = filteredList.length ? 0 : -1;

  renderPlaylist(filteredList, true);

  if (filteredList.length) {
    highlightPlaying();
  }
}

categorySelect.addEventListener("change", () => {
  const tag = categorySelect.value;
  // Clear search box when selecting category to avoid confusion
  if (searchSong) searchSong.value = "";
  filterByCategory(tag);
});

/* ======================
   SELECT CHANGE (dropdown) - DISESUAIKAN AGAR SUPPORT KATEGORI
====================== */
function onSelectChange() {
  const id = songSelect.value;
  if (!id) return;
  const activeCategory = (categorySelect && categorySelect.value) ? categorySelect.value : null;

  if (activeCategory) {
    const listTagsMatch = filteredList.length && (filteredList[0].tags || []).includes(activeCategory);
    if (!listTagsMatch) {
      filterByCategory(activeCategory);
    }

    const pos = filteredList.findIndex(f => String(f.id) === String(id));
    if (pos !== -1) {
      filteredMode = true;
      currentFilteredIndex = pos;
      const realIndex = filteredList[currentFilteredIndex].index;
      loadSongByIndex(realIndex);
      playAudio();
      return;
    }
  }


  filteredMode = false;
  currentFilteredIndex = -1;
  const idx = playlist.findIndex(p => String(p.id) === String(id));
  if (idx !== -1) {
    loadSongByIndex(idx);
    playAudio();
  }
}
/* ======================
   MENU & SUBMENU
====================== */
document.addEventListener("DOMContentLoaded", () => {
    menuBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        menuPanel.style.display = menuPanel.style.display === "block" ? "none" : "block";
    });

    const submenuMap = {
        qualityMenuBtn: "qualitySubmenu",
        sleepTimeBtn: "sleepSubmenu",
        equalizerBtn: "equalizerSubmenu"
    };

    Object.keys(submenuMap).forEach(btnId => {
        const btn = document.getElementById(btnId);
        const submenu = document.getElementById(submenuMap[btnId]);
        if (!btn || !submenu) return;

        btn.addEventListener("click", (e) => {
            e.stopPropagation();
            document.querySelectorAll(".submenu").forEach(sm => {
                if (sm !== submenu) sm.style.display = "none";
            });
            submenu.style.display = submenu.style.display === "block" ? "none" : "block";
        });
    });

    document.addEventListener("click", () => {
        menuPanel.style.display = "none";
        document.querySelectorAll(".submenu").forEach(sm => sm.style.display = "none");
    });
});

/* ======================
   SLEEP TIMER
====================== */
let sleepTimer;
sleepSub.querySelectorAll(".submenu-item").forEach(item => {
    item.addEventListener("click", () => {
        const minutes = parseInt(item.dataset.time);
        if (sleepTimer) clearTimeout(sleepTimer);

        sleepTimer = setTimeout(() => {
            audio.pause();
            isPlaying = false;
            playBtn.textContent = "â–¶";
            cd.classList.remove('playing');
            alert(`Waktu ${minutes} menit telah selesai. Musik berhenti.`);
        }, minutes * 60 * 1000);

        alert(`Sleep Timer diatur selama ${minutes} menit`);
        sleepSub.style.display = "none";
    });
});

/* ======================
   REPORT
====================== */
reportBtn.addEventListener("click", () => {
    const currentSong = (filteredMode && filteredList.length && currentFilteredIndex >= 0)
        ? filteredList[currentFilteredIndex]
        : playlist[currentRealIndex];

    if (!currentSong) {
        alert("Tidak ada lagu yang diputar untuk dilaporkan!");
        return;
    }

    const subject = encodeURIComponent(`Report lagu: ${currentSong.title}`);
    const body = encodeURIComponent(`Saya ingin melaporkan lagu ini:\n\nJudul: ${currentSong.title}\nArtis: ${currentSong.artist}`);
    window.open(`mailto:zainsuryo10@gmail.com?subject=${subject}&body=${body}`);
});

/* ======================
   VISUALIZER
====================== */
setInterval(() => {
    if (!isPlaying) {
        visualBars.forEach(b => b.style.height = '6px');
        return;
    }
    visualBars.forEach(b => b.style.height = (6 + Math.random() * 34) + 'px');
}, 140);

/* ======================
   INIT
====================== */
(function init() {
  // initial render uses playlist (full)
  renderPlaylist(playlist, false);
  // load first song (index 0)
  loadSongByIndex(0);
})();
